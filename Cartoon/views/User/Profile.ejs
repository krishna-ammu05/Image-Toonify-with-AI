<% layout('User/user_Boilerplate') -%>

<div class="container my-5">
  <h1 class="mb-4 text-primary fw-bold">
    <i class="bi bi-person-circle"></i> My Profile
  </h1>

  <div class="row">
    <!-- Left Column -->
    <div class="col-md-4">
      <!-- Profile Card -->
      <div class="card text-center mb-4 shadow-lg border-0 rounded-3">
        <div class="card-body">
          <% if(user.avatar){ %>
            <img src="<%= user.avatar %>" 
                 alt="Profile Picture" 
                 class="rounded-circle mb-3 border border-3 border-primary" 
                 width="120" height="120">
          <% } else { %>
            <div class="rounded-circle mb-3 d-flex align-items-center justify-content-center bg-primary text-white fw-bold mx-auto" 
                 style="width:120px;height:120px;font-size:48px;">
              <%= user.username ? user.username.charAt(0).toUpperCase() : '?' %>
            </div>
          <% } %>
          <h4 class="fw-bold"><%= user.username %></h4>
          <p class="text-muted mb-1"><i class="bi bi-envelope"></i> <%= user.email %></p>
          <% if(user.phone){ %>
            <p class="text-muted"><i class="bi bi-telephone"></i> <%= user.phone %></p>
          <% } %>
        </div>
      </div>

      <!-- Danger Zone -->
      <div class="card border-danger shadow-sm rounded-3">
        <div class="card-body">
          <h5 class="card-title text-danger fw-bold mb-3">
            <i class="bi bi-exclamation-triangle"></i> Danger Zone
          </h5>
          <form action="/profile/reset" method="POST" class="mb-2">
            <button type="submit" class="btn btn-outline-danger w-100">
              ğŸ”„ Reset All Data
            </button>
          </form>
          <form action="/<%= user.username %>?_method=DELETE" method="POST">
             <button type="submit" class="btn btn-danger w-100">
               âŒ Delete Account
             </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="col-md-8">
      <!-- Subscription & Plan -->
      <div class="card mb-4 shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h5 class="card-title fw-bold text-primary">
            <i class="bi bi-gem"></i> Subscription & Plan
          </h5>
          <p>Current Plan: <strong><%= user.plan %></strong></p>
          <p>Status: 
            <span class="badge rounded-pill 
              <%= user.status === 'Active' ? 'bg-success' : 
                  user.status === 'Inactive' ? 'bg-warning text-dark' : 
                  'bg-danger' %> px-3 py-2">
              <%= user.status %>
            </span>
          </p>
          <p>Renewal Date: 
            <strong><%= user.renewalDate ? user.renewalDate.toDateString() : 'N/A' %></strong>
          </p>
          <div class="mt-3">
            <a href="/subscription/upgrade" class="btn btn-success me-2">
              ğŸš€ Upgrade Plan
            </a>
            <a href="/subscription/cancel" class="btn btn-outline-secondary">
              â Cancel Plan
            </a>
          </div>
        </div>
      </div>

      <!-- Usage Stats -->
      <div class="card mb-4 shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h5 class="card-title fw-bold text-primary">
            <i class="bi bi-bar-chart"></i> Usage Stats
          </h5>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">ğŸ“¤ Total Uploads: <strong><%= user.uploads %></strong></li>
            <li class="list-group-item">ğŸ”„ Total Conversions: <strong><%= user.conversions %></strong></li>
            <li class="list-group-item">ğŸ“Š Remaining Quota: 
              <strong><%= user.remainingQuota || 'Unlimited' %></strong>
            </li>
            <li class="list-group-item">ğŸ’¾ Storage Used: 
              <strong><%= user.storageUsed || 0 %> / <%= user.storageLimit || 'âˆ' %></strong>
            </li>
          </ul>
        </div>
      </div>

      <!-- Personalization -->
      <div class="card mb-4 shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h5 class="card-title fw-bold text-primary">
            <i class="bi bi-sliders"></i> Personalization
          </h5>
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="darkModeSwitch" <%= user.darkMode ? 'checked' : '' %>>
            <label class="form-check-label" for="darkModeSwitch">ğŸŒ™ Dark Mode</label>
          </div>
          <div class="mb-3">
            <label class="form-label">ğŸ¨ Preferred Output Style</label>
            <select class="form-select">
              <option <%= user.outputStyle === 'Cartoon' ? 'selected' : '' %>>Cartoon</option>
              <option <%= user.outputStyle === 'Anime' ? 'selected' : '' %>>Anime</option>
              <option <%= user.outputStyle === 'Sketch' ? 'selected' : '' %>>Sketch</option>
            </select>
          </div>
          <div>
            <label class="form-label">ğŸŒ Language Preference</label>
            <select class="form-select">
              <option <%= user.language === 'English' ? 'selected' : '' %>>English</option>
              <option <%= user.language === 'Hindi' ? 'selected' : '' %>>Hindi</option>
              <option <%= user.language === 'Spanish' ? 'selected' : '' %>>Spanish</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h5 class="card-title fw-bold text-primary">
            <i class="bi bi-clock-history"></i> Recent Activity
          </h5>
          <% if(user.recentActivity && user.recentActivity.length > 0){ %>
            <ul class="list-group">
              <% user.recentActivity.forEach(activity => { %>
                <li class="list-group-item">âœ… <%= activity %></li>
              <% }) %>
            </ul>
          <% } else { %>
            <p class="text-muted fst-italic">No recent activity found.</p>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>
