<% layout('User/user_Boilerplate') -%>

<section class="container mt-5">
  <h2 class="text-center fw-bold text-primary mb-4">ğŸ“¤ Upload & Convert Image</h2>

  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-4">
          <!-- Upload Form -->
          <form
            action="/<%= user.username %>/upload"
            method="POST"
            enctype="multipart/form-data"
          >
            <!-- Title Input -->
              <div class="mb-4">
                    <label for="title" class="form-label fw-semibold">Image Title</label>
                    <input
                      type="text"
                      name="title"
                      id="title"
                      class="form-control"
                      placeholder="Enter a title for your image"
                      required
                    />
        </div>

            <!-- File Upload -->
            <div class="mb-4">
              <label for="image" class="form-label fw-semibold">Select Image</label>
              <input
                type="file"
                name="image"
                id="image"
                class="form-control"
                required
              />
            </div>

            <!-- Style Selection -->
            <div class="mb-4">
              <label for="style" class="form-label fw-semibold">Choose Style</label>
              <select name="style" id="style" class="form-select" required>
                <option value="pencil">âœï¸ Pencil Sketch</option>
                <option value="cartoon">ğŸ¨ Cartoon</option>
                <option value="grayscale">ğŸ–¤ Grayscale</option>
                <option value="sketch">ğŸ–Œï¸ Sketch Art</option>
                <option value="ghibli">ğŸŒ¸ Ghibli Style</option>
              </select>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              class="btn btn-gradient w-100 rounded-pill fw-bold"
            >
              Convert
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Show results only if processed image exists -->
  <% if (outputImage) { %>
  <div class="row mt-5 justify-content-center">
    <div class="col-md-10">
      <h4 class="text-center fw-bold mb-4">ğŸ” Comparison</h4>
      <div class="d-flex justify-content-around align-items-center flex-wrap gap-3">
        <!-- Original -->
        <div class="text-center">
          <h6 class="fw-semibold">Original</h6>
          <img src="/<%= originalImage %>" class="img-fluid rounded shadow" style="max-width: 300px;" />
        </div>
        <!-- Processed -->
        <div class="text-center">
          <h6 class="fw-semibold">Converted (<%= selectedStyle %>)</h6>
          <img src="/<%= outputImage %>" class="img-fluid rounded shadow" style="max-width: 300px;" />
        </div>
      </div>

      <!-- Buttons -->
      <div class="text-center mt-4 d-flex justify-content-center gap-3">
        <!-- Download Button -->
        <a href="/<%= outputImage %>" download class="btn btn-gradient rounded-pill fw-bold px-4">
          â¬‡ï¸ Download
        </a>

        <!-- Share Button -->
        <button
          class="btn btn-gradient rounded-pill fw-bold px-4"
          onclick="shareImage('<%= outputImage %>')"
        >
          ğŸ“¤ Share
        </button>
      </div>
    </div>
  </div>
  <% } %>
</section>

<!-- Share Script -->
<script>
  function shareImage(imagePath) {
    const fullUrl = window.location.origin + '/' + imagePath;

    if (navigator.share) {
      navigator.share({
        title: "Check out my converted image!",
        text: "Hereâ€™s my image in a new style:",
        url: fullUrl,
      });
    } else {
      navigator.clipboard.writeText(fullUrl);
      alert("ğŸ”— Link copied to clipboard!");
    }
  }
</script>

<style>
  .btn-gradient {
    background: linear-gradient(90deg, #4e73df, #1cc88a);
    border: none;
    color: white;
    transition: 0.3s ease-in-out;
  }
  .btn-gradient:hover {
    opacity: 0.9;
    transform: scale(1.02);
  }
</style>
