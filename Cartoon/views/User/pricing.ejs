<% layout('User/user_Boilerplate') -%>

<section class="container mt-5">
  <!-- Section Heading -->
  <h2 class="text-center mb-5 fw-bold text-gradient">
    ðŸ”‘ Subscription Plans <br />
    <small class="fw-normal text-muted">Unlimited Access to All Features</small>
  </h2>

  <div class="row g-4 justify-content-center">
    <!-- Monthly Plan -->
    <div class="col-md-4">
      <div class="card shadow-lg h-100 border-0 pricing-card">
        <div class="card-body d-flex flex-column text-center">
          <h5 class="card-title fw-bold">Monthly</h5>
          <p class="card-text text-muted">Pay month by month</p>
          <h3 class="fw-bold display-6 text-primary">
            â‚¹799 <small class="fs-6 text-muted">/month</small>
          </h3>
          <ul class="list-unstyled mt-4 mb-4 flex-grow-1">
            <li>âœ” Unlimited image transforms</li>
            <li>âœ” All styles & filters</li>
            <li>âœ” Cancel anytime</li>
          </ul>
          <button
            class="btn btn-primary btn-lg w-100 rounded-pill"
            onclick="startPayment(799, 'monthly')"
          >
            Buy Monthly (â‚¹799)
          </button>
        </div>
      </div>
    </div>

    <!-- 6-Month Plan -->
    <div class="col-md-4">
      <div class="card shadow-lg h-100 border-danger border-2 pricing-card featured">
        <div class="card-body d-flex flex-column text-center">
          <span class="badge bg-danger mb-3 px-3 py-2 fs-6">ðŸ”¥ Best Value</span>
          <h5 class="card-title fw-bold">6-Month Plan</h5>
          <p class="card-text text-muted">Save 20% vs monthly</p>
          <h3 class="fw-bold display-6 text-danger">
            â‚¹4,199 <small class="fs-6 text-muted">/6mo</small>
          </h3>
          <ul class="list-unstyled mt-4 mb-4 flex-grow-1">
            <li>âœ” Unlimited image transforms</li>
            <li>âœ” Priority processing</li>
            <li>âœ” Cancel anytime</li>
          </ul>
          <button
            class="btn btn-danger btn-lg w-100 rounded-pill"
            onclick="startPayment(4199, '6month')"
          >
            Buy 6-Month (â‚¹4199)
          </button>
        </div>
      </div>
    </div>

    <!-- Annual Plan -->
    <div class="col-md-4">
      <div class="card shadow-lg h-100 border-0 pricing-card">
        <div class="card-body d-flex flex-column text-center">
          <h5 class="card-title fw-bold">Annual Plan</h5>
          <p class="card-text text-muted">Save 30% vs monthly</p>
          <h3 class="fw-bold display-6 text-success">
            â‚¹7,999 <small class="fs-6 text-muted">/yr</small>
          </h3>
          <ul class="list-unstyled mt-4 mb-4 flex-grow-1">
            <li>âœ” Unlimited image transforms</li>
            <li>âœ” Highest resolution outputs</li>
            <li>âœ” Priority support</li>
          </ul>
          <button
            class="btn btn-success btn-lg w-100 rounded-pill"
            onclick="startPayment(7999, 'annual')"
          >
            Buy Annual (â‚¹7999)
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ðŸ”¹ Custom CSS Enhancements -->
<style>
  /* Gradient Heading */
  .text-gradient {
    background: linear-gradient(45deg, #007bff, #00c6ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Card Styling */
  .pricing-card {
    border-radius: 1rem;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .pricing-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 1.5rem 2rem rgba(0, 0, 0, 0.15);
  }

  /* Featured (6-month plan) */
  .featured {
    transform: scale(1.05);
    border-width: 3px !important;
  }
  .featured:hover {
    transform: scale(1.08);
  }

  /* Buttons */
  .btn {
    transition: all 0.3s ease;
  }
  .btn:hover {
    opacity: 0.9;
    transform: scale(1.02);
  }
</style>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  // âš¡ Same functionality (unchanged)
  async function startPayment(amount, planType) {
    try {
      const res = await fetch("/payment/create-order", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount, plan: planType }),
      });

      const order = await res.json();

      if (order.id) {
        openRazorpay(order);
      } else {
        alert("Error creating order");
      }
    } catch (err) {
      console.error("Payment error:", err);
      alert("Something went wrong while starting payment");
    }
  }

  function openRazorpay(order) {
    var options = {
      key: "<%= process.env.RAZORPAY_KEY_ID %>",
      amount: order.amount,
      currency: order.currency,
      name: "My App",
      description: "Subscription Payment",
      order_id: order.id,
      handler: function (response) {
        fetch("/payment/verify-payment", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(response),
        })
          .then((res) => {
            if (res.redirected) {
              window.location.href = res.url;
            } else {
              return res.json();
            }
          })
          .then((data) => {
            if (data && !data.success) {
              alert("Payment verification failed: " + data.message);
            }
          })
          .catch((err) => {
            console.error("Verification error:", err);
            alert("Something went wrong while verifying payment");
          });
      },
    };
    var rzp = new Razorpay(options);
    rzp.open();
  }
</script>
